<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Lab - Runtime Example (Exec and Package MGR execution) :: Placeholder Course Title</title>
    <link rel="prev" href="section3.html">
    <link rel="next" href="section5.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Placeholder Course Title</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/rhacs-policy-management /issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="placeholder-course-name" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Placeholder Course Title</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Policy Overview</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section1.html">Introduction to Policies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section2.html">Lab - Build Example (Fixable Severity At least Important)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section3.html">Lab - Deploy Example (Log4Shell)</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="section4.html">Lab - Runtime Example (Exec and Package MGR execution)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section5.html">Conclusion</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../chapter2/index.html">Creating Custom Policies</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter2/section1.html">Introduction to Custom Policies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter2/section2.html">Lab - Create a Custom Policy</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter2/section3.html">Conclusion</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../chapter3/index.html">Addressing Policy Violations</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter3/section1.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter3/section2.html">Lab - Runtime Policy Violation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter3/section3.html">Conclusion</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendix/appendix.html">Appendix A</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Placeholder Course Title</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Placeholder Course Title</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Placeholder Course Title</a></li>
    <li><a href="index.html">Policy Overview</a></li>
    <li><a href="section4.html">Lab - Runtime Example (Exec and Package MGR execution)</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Lab - Runtime Example (Exec and Package MGR execution)</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><mark>FIX_MISSING_IMAGES</mark></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_goals"><a class="anchor" href="#_goals"></a>Goals</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Understand runtime policy enforcement features</p>
</li>
<li>
<p>Prevent execution of package manager binary</p>
</li>
<li>
<p>Report and resolve violations</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_runtime_policy_features"><a class="anchor" href="#_runtime_policy_features"></a>Runtime Policy Features</h2>
<div class="sectionbody">
<div class="paragraph">
<p>RHACS observes the processes running in containers, and collects this information to write policies.
This information can also be used to create baseline policy configurations that can be updated by the user.</p>
</div>
<div class="paragraph">
<p>This allows the user to quickly assess and address novel situations.</p>
</div>
<div class="sect2">
<h3 id="_clean_up_blocking_policies"><a class="anchor" href="#_clean_up_blocking_policies"></a>Clean Up Blocking Policies</h3>
<div class="paragraph">
<p>The <code>No bash allowed</code> policy from lab 4 will block this lab, so you must delete it. You may also have to do the same for the "Images with no scans" policy from the previous lab.</p>
</div>
<div class="sect3">
<h4 id="_procedure"><a class="anchor" href="#_procedure"></a>Procedure</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigate to <strong>Platform Configuration &#8594; Policy Management</strong> and find the <code>No bash allowed</code> policy.</p>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>On the <strong>System Management</strong> page, type <code>Policy</code> and then <code>no bash</code> into the filter bar at the top.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>2 Select the three dots to the right of the policy and delete it.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_prevent_execution_of_package_manager_binary"><a class="anchor" href="#_prevent_execution_of_package_manager_binary"></a>Prevent Execution of Package Manager Binary</h3>
<div class="paragraph">
<p>Package managers like <code>apt</code> (Ubuntu), <code>apk</code> (Alpine), or <code>yum</code> (RedHat) are binary software components used to manage and update installed software on a Linux<sup>&#174;</sup> host system.
They are used extensively to manage running virtual machines. But using a package manager to install or remove software on a running container violates the immutable principle of container operation.</p>
</div>
<div class="paragraph">
<p>This policy demonstrates how RHACS detects and avoids a runtime violation, using Linux kernel instrumentation to detect the running process and OpenShift<sup>&#174;</sup> to terminate the pod for enforcement.</p>
</div>
<div class="paragraph">
<p>Using OpenShift to enforce runtime policy is preferable to enforcing rules directly within containers or in the container engine, as it avoids a disconnect between the state that OpenShift is maintaining and the state in which the container is actually operating.
Further, because a runtime policy may detect only part of an attacker&#8217;s activity inside a container, removing the container avoids the attack.</p>
</div>
</div>
<div class="sect2">
<h3 id="_enable_enforcement_of_policy"><a class="anchor" href="#_enable_enforcement_of_policy"></a>Enable Enforcement of Policy</h3>
<div class="sect3">
<h4 id="_procedure_2"><a class="anchor" href="#_procedure_2"></a>Procedure</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigate to <strong>Platform Configuration &#8594; Policy Management</strong> and find the <code>Ubuntu Package Manager Execution</code> policy.</p>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>On the <strong>Policy Management</strong> page, type <code>Policy</code> + <code>Ubuntu</code> into the filter bar at the top.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Select the policy <code>Ubuntu Package Manager Execution</code>, and edit the policy.</p>
</li>
<li>
<p>Use the <code>Policy Behavior</code> tab and enable runtime enforcement by clicking the <code>inform and enforce button</code></p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
<div class="imageblock unresolved">
<div class="content">
<img src="images/10_runtime_00.png" alt="RHACS run time Violations">
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_test_policy"><a class="anchor" href="#_test_policy"></a>Test Policy</h3>
<div class="paragraph">
<p>In this section, you use <code>tmux</code> to watch OpenShift <em>events</em> while running the test, so you can see how RHACS enforces the policy at runtime.</p>
</div>
<div class="sect3">
<h4 id="_procedure_3"><a class="anchor" href="#_procedure_3"></a>Procedure</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On your student VM, start <code>tmux</code> with two panes:</p>
<div class="listingblock">
<div class="content">
<pre>tmux new-session \; split-window -v \; attach</pre>
</div>
</div>
</li>
<li>
<p>Run a watch on OpenShift events in the first shell pane:</p>
<div class="listingblock">
<div class="content">
<pre>oc get events -w</pre>
</div>
</div>
</li>
<li>
<p>Type <code>Ctrl-b o</code> to switch to the next pane.</p>
</li>
<li>
<p>Run a temporary Ubuntu OS image using the <code>tmp-shell</code> application:</p>
<div class="listingblock">
<div class="content">
<pre>oc run tmp-shell --labels="app=tmp-shell" --rm -i --tty --image ubuntu:18.04 -- /bin/bash

If you don't see a command prompt, try pressing enter.
root@tmp-shell:/#</pre>
</div>
</div>
<div class="paragraph">
<p>After the cluster pulls the image and starts the pod, expect to see a Linux command shell as shown.</p>
</div>
</li>
<li>
<p>Run the package manager in this shell:</p>
<div class="listingblock">
<div class="content">
<pre>root@tmp-shell-65c98c7766-66fpw:/# apt update</pre>
</div>
</div>
</li>
<li>
<p>Examine the output and expect to see that the package manager performs an update operation:</p>
<div class="listingblock">
<div class="content">
<pre>Get:1 http://security.ubuntu.com/ubuntu bionic-security InRelease [88.7 kB]
Get:2 http://archive.ubuntu.com/ubuntu bionic InRelease [242 kB]
Get:3 http://security.ubuntu.com/ubuntu bionic-security/restricted amd64 Packages [860 kB]
Get:4 http://archive.ubuntu.com/ubuntu bionic-updates InRelease [88.7 kB]
Get:5 http://archive.ubuntu.com/ubuntu bionic-backports InRelease [74.6 kB]
Get:6 http://archive.ubuntu.com/ubuntu bionic/universe amd64 Packages [11.3 MB]
Get:7 http://security.ubuntu.com/ubuntu bionic-security/universe amd64 Packages [1484 kB]
Get:8 http://security.ubuntu.com/ubuntu bionic-security/multiverse amd64 Packages [21.1 kB]
Get:9 http://security.ubuntu.com/ubuntu bionic-security/main amd64 Packages [2660 kB]
Get:10 http://archive.ubuntu.com/ubuntu bionic/main amd64 Packages [1344 kB]
Get:11 http://archive.ubuntu.com/ubuntu bionic/multiverse amd64 Packages [186 kB]
Get:12 http://archive.ubuntu.com/ubuntu bionic/restricted amd64 Packages [13.5 kB]
Get:13 http://archive.ubuntu.com/ubuntu bionic-updates/restricted amd64 Packages [893 kB]
Get:14 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 Packages [3098 kB]
Get:15 http://archive.ubuntu.com/ubuntu bionic-updates/universe amd64 Packages [2262 kB]
Get:16 http://archive.ubuntu.com/ubuntu bionic-updates/multiverse amd64 Packages [29.8 kB]
Get:17 http://archive.ubuntu.com/ubuntu bionic-backports/main amd64 Packages [11.6 kB]
Get:18 http://archive.ubuntu.com/ubuntu bionic-backports/universe amd64 Packages [12.6 kB]
97% [13 Packages store 0 B]
Fetched 24.7 MB in 3s (7158 kB/s)
Reading package lists... Done
Building dependency tree
Reading state information... Done
All packages are up to date.</pre>
</div>
</div>
</li>
<li>
<p>Examine the <code>oc get events</code> tmux pane, and note that it shows that RHACS detected the package manager invocation and deleted the pod:</p>
<div class="listingblock">
<div class="content">
<pre>0s          Normal    Scheduled              pod/tmp-shell   Successfully assigned tok-00-project/tmp-shell to ip-10-0-239-17.us-east-2.compute.internal
0s          Normal    AddedInterface         pod/tmp-shell   Add eth0 [10.128.1.130/23] from openshift-sdn
0s          Normal    Pulled                 pod/tmp-shell   Container image "ubuntu:18.04" already present on machine
0s          Normal    Created                pod/tmp-shell   Created container tmp-shell
0s          Normal    Started                pod/tmp-shell   Started container tmp-shell
0s          Warning   StackRox enforcement   pod/tmp-shell   A pod (tmp-shell) violated StackRox policy "Ubuntu Package Manager Execution" and was killed
0s          Normal    Killing                pod/tmp-shell   Stopping container tmp-shell</pre>
</div>
</div>
<div class="paragraph">
<p>After about 30 seconds, you can see that the pod is deleted.</p>
</div>
</li>
<li>
<p>In your <code>tmux</code> shell pane, note that your shell session has terminated and that you are returned to the student VM command line:</p>
<div class="listingblock">
<div class="content">
<pre>root@tmp-shell:/#
root@tmp-shell:/# Session ended, resume using 'oc attach tmp-shell -c tmp-shell -i -t' command when the pod is running
No resources found
[lab-user@bastion ~]$</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_report_and_resolve_violations"><a class="anchor" href="#_report_and_resolve_violations"></a>Report and Resolve Violations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>At this point, any attacker using a shell to install software is now disconnected from the environment.
A complete record of the event is available on the <strong>Violations</strong> page.</p>
</div>
<div class="sect2">
<h3 id="_procedure_4"><a class="anchor" href="#_procedure_4"></a>Procedure</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigate to the <strong>Violations</strong> page.</p>
</li>
<li>
<p>Find the violation labeled <code>tmp-shell</code> and select the <code>Ubuntu Package Manager Execution</code> policy.</p>
</li>
<li>
<p>Explore the list of the violation events:</p>
<div class="imageblock unresolved">
<div class="content">
<img src="images/rhacs_runtime_violations_tmp-shell.png" alt="RHACS run time Violations">
</div>
</div>
<div class="paragraph">
<p>If configured, each violation record is pushed to a Security Information and Event Management (SIEM) integration, and is available to be retrieved via the API.
The forensic data shown in the UI is recorded, including the timestamp, process user IDs, process arguments, process ancestors, and enforcement action.</p>
</div>
<div class="paragraph">
<p>For more information about integration with SIEM tools, see the RHACS help documentation on <a href="https://docs.openshift.com/acs/3.74/welcome/index.html#integrating-with-other-products" target="_blank" rel="noopener">external tools</a>.</p>
</div>
<div class="paragraph">
<p>After this issue is addressed&#8212;&#8203;in this case by the RHACS product using the runtime enforcement action&#8212;&#8203;you can remove it from the list by marking it as <code>Resolved</code>.</p>
</div>
</li>
<li>
<p>Hover over the violation in the list to see the resolution options:</p>
<div class="imageblock unresolved">
<div class="content">
<img src="images/rhacs_runtime_violations_tmp-shell_resolved.png" alt="RHACS Violation Resolved">
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_summary"><a class="anchor" href="#_summary"></a>Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this lab, you learned some of the unique features of runtime policy enforcement.
This includes process monitoring and pod deletion based on your specified criteria.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="section3.html">Lab - Deploy Example (Log4Shell)</a></span>
  <span class="next"><a href="section5.html">Conclusion</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
